# -*- coding:utf-8 -*-
# @Time       :2021/1/27 22:30
# @Author     :Xing CHEN
# @Site       :
# @File       :eval_score.py
# @Software   :PyCharm
# @Dirction   :None

from tools.sample.cider.cider import Cider
from rouge import Rouge

def _strip(s):
    return s.strip()

def cider_all(ref_list:list,hyp_list:list):
    ref_list = [list(map(_strip, refs)) for refs in zip(*ref_list)]
    refs = {idx: strippedlines for (idx, strippedlines) in enumerate(ref_list)}
    hyps = {idx: [lines.strip()] for (idx, lines) in enumerate(hyp_list)}
    cider_eval = Cider()
    score , scores = cider_eval.compute_score(refs,hyps)
    return score,scores

def avg_rouge(b:str,a:list):
    r1_total = 0
    r2_total = 0
    rl_total = 0
    n = len(a)
    for each in a:
        if len(each) <= 0:
            continue
        if len(b) <= 0:
            continue
        r1, r2, rl = rouge(b , each)
        r1_total += r1
        r2_total += r2
        rl_total += rl
    return r1_total/n,r2_total/n,rl_total/n


def rouge(a:str, b:str):
    # a预测
    # b参考
    rouge = Rouge()

    rouge_score = rouge.get_scores(a, b,avg=True)
    # 以上两句可根据自己的需求来进行选择
    r1 = rouge_score["rouge-1"]['f']
    r2 = rouge_score["rouge-2"]['f']
    rl = rouge_score["rouge-l"]['f']

    return r1, r2, rl




if __name__ == '__main__':

    print(avg_rouge('wo shi ',['wo shi chenxing','ni hao']))
    hyps = ['this is the model generated sentence1 which seems good enough','this is sentence2 which has been generated by your model']
    refs = [['this is one reference sentence for sentence1','this is a reference sentence for sentence2 which was generated by your model'],['this is one more reference sentence for sentence1', 'this is the second reference sentence for sentence2']]

    print(cider_all(refs,hyps))